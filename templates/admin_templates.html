{% extends "base.html" %}
{% block title %}Disease Templates | Admin{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="section-header">
            <span class="section-label">Administration</span>
            <h2 class="section-title">Clinical Pathway Templates</h2>
            <p class="section-subtitle">Define structured recovery pathways. Click on a Template ID badge to copy it â€”
                you'll need it to assign a journey to a patient.</p>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1.6fr; gap: 2rem; align-items: start;">

            <!-- Create Form -->
            <div class="card" style="position: sticky; top: 90px;">
                <h3 style="font-size:1rem; font-weight:600; margin-bottom:1rem;">âž• Create New Template</h3>
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div style="margin-bottom: 1rem;">
                        <label>Template Name</label>
                        <input type="text" name="name" required placeholder="e.g. Major Depressive Disorder">
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label>Description</label>
                        <textarea name="description" rows="3" placeholder="Brief overview of the pathway..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%;">Create Template</button>
                </form>
            </div>

            <!-- Existing Templates -->
            <div>
                <h3 style="font-size:1rem; font-weight:600; margin-bottom:1rem;">ðŸ“‹ Existing Templates</h3>
                {% if templates %}
                {% for t in templates %}
                <div class="card" style="margin-bottom: 1rem;">
                    <div
                        style="display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; gap:.5rem; margin-bottom:.75rem;">
                        <div>
                            <div style="font-weight:600; font-size:1rem;">{{ t.name }}</div>
                            {% if t.description %}
                            <div style="font-size:.85rem; color:var(--c-text-secondary); margin-top:.25rem;">{{
                                t.description }}</div>
                            {% endif %}
                        </div>
                        <!-- Template ID badge â€” click to copy -->
                        <button
                            onclick="navigator.clipboard.writeText('{{ t.id }}'); this.textContent='âœ… Copied!'; setTimeout(()=>this.textContent='ID: {{ t.id }}',1500);"
                            style="background:var(--c-primary-soft); color:var(--c-primary); border:1px solid rgba(92,135,102,.3);
                     padding:4px 14px; border-radius:999px; font-size:.75rem; font-weight:700;
                     cursor:pointer; font-family:monospace; white-space:nowrap; flex-shrink:0;"
                            title="Click to copy Template ID">
                            ID: {{ t.id }}
                        </button>
                    </div>
                    <a href="{{ url_for('admin_template_stages', template_id=t.id) }}"
                        class="btn btn-sm btn-primary">Manage Stages â†’</a>
                </div>
                {% endfor %}
                {% else %}
                <div class="empty-state" style="padding:3rem 1rem;">
                    <p>No templates yet. Create one on the left to get started.</p>
                </div>
                {% endif %}
            </div>

        </div>
    </div>
</section>
{% endblock %}